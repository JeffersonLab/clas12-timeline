#!/usr/bin/env bash

set -e
set -u
source $(dirname $0)/../libexec/environ.sh

sep="================================================================"
usage() {
  echo """
  $sep
  USAGE: $0 [COMMAND] [OPTIONS]...
  $sep
  Run clas12-timeline commands.

  COMMAND: the command to run, one of:
      histogram     Run the timeline histogramming jobs
      analysis      Analyze the histograms and generate timelines
      deploy        Deploy the timelines to the web server
      error         Scan for errors in Slurm logs

  OPTIONS: Each command has its own set of options; run a command with no
           additional options to see usage for that command.

  ADDITIONAL OPTIONS:
      -v, --version  Print version number
      -h, --help     Show this message
  """ >&2
}
if [ $# -eq 0 ]; then
  usage
  exit 101
fi

cmd=$1
shift

case $cmd in
  hi*) exec $TIMELINESRC/bin/thyme-histogram "$@" ;;
  an*) exec $TIMELINESRC/bin/thyme-analysis "$@" ;;
  de*) exec $TIMELINESRC/bin/thyme-deploy "$@" ;;
  er*) exec $TIMELINESRC/bin/thyme-error "$@" ;;
  -v|--version)
    echo $(mvn -q -Dexec.executable=echo -Dexec.args='${project.version}' --non-recursive exec:exec -f $TIMELINESRC/pom.xml || echo "UNKNOWN")
    exit 0
    ;;
  -h|--help)
    usage
    exit 101
    ;;
  *)
    printError "unknown command '$cmd'"
    exit 100
    ;;
esac
